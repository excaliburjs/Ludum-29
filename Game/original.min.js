function hasClass(n,t){return n.classList.contains(t)}function replaceClass(n,t,i){hasClass(n,t)&&(this.removeClass(n,t),this.addClass(n,i))}function addClass(n,t){n.classList.add(t)}function removeClass(n,t){n.classList.remove(t)}function setVolume(n){for(var t in Resources)Resources.hasOwnProperty(t)&&Resources[t]instanceof ex.Sound&&(Resources[t].setVolume(n),t==="SoundWaves"&&n>0&&Resources[t].setVolume(.1),t==="SoundTrack"&&n>0&&Resources[t].setVolume(.2))}var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Bullet=function(n){function t(t,i,r,u){n.call(this,t,i,3,3,ex.Color.Red);this.bulletSpriteSheet=new ex.SpriteSheet(Resources.BulletTexture,6,1,32,32);this.bulletAnimation=this.bulletSpriteSheet.getAnimationForAll(game,200);this.collisionType=1;var e=new ex.Vector(t,i),o=new ex.Vector(r,u),f=o.minus(e).normalize().scale(Config.defaultEnemyBulletSpeed);this.dx=f.x;this.dy=f.y;this.bulletAnimation.loop=!0;this.addDrawing("default",this.bulletAnimation);this.setCenterDrawing(!0);this.remainingLife=Config.defaultEnemyBulletLife}return __extends(t,n),t.prototype.update=function(t,i){if(n.prototype.update.call(this,t,i),!(t.currentScene instanceof BaseLevel)){this.kill();return}var r=t.currentScene.data;if(this.x<=0||this.y<=0||this.x>=r.width*r.tilewidth||this.y>=r.height*r.tileheight){this.kill();return}if(this.remainingLife<=0){this.kill();return}this.remainingLife-=i},t}(ex.Actor),Config=function(){function n(){}return n.deathTimer=5e3,n.defaultKrakenMoveRadius=300,n.defaultKrakenWidth=50,n.defaultKrakenHeight=50,n.defaultKrakenSpeedScale=10,n.defaultKrakenMaxSpeed=200,n.defaultKrakenIdleThreshold=10,n.defaultKrakenAnimationChangeThreshold=400,n.defaultKrakenHealth=100,n.defaultKrakenSpecial=5,n.krakenDps=1,n.krakenAttackTime=300,n.krakenAttackRange=150,n.krakenInertiaDampen=1,n.krakenHealthRegen=10,n.defaultEnemyWidth=73,n.defaultEnemyHeight=73,n.defaultEnemyBulletWait=2e3,n.defaultEnemyBulletSpeed=300,n.defaultEnemyAlertDistance=500,n.defaultEnemyBulletLife=2e4,n.defaultEnemyHealth=10,n.defaultEnemySpeed=100,n.defaultAssistDistance=300,n.defaultEnemyWaitTime=2e3,n.enemyRotationSpeed=Math.PI/1.5,n.enemyDps=10,n.enemyGunOffset=80,n.enemyAlertOffsetX=0,n.enemyAlertOffsetY=-20,n.defaultEnemyMaxFiringDistance=400,n.defaultMaxAttackDistance=250,n.defaultMaxAlertDistance=275,n.defaultEnemyFOV=500,n.defaultSonarPingScale=4e3,n.defaultSonarPingSpeed=600,n}(),DeathScene=function(n){function t(){n.call(this)}return __extends(t,n),t.prototype.onInitialize=function(t){var u,f;n.prototype.onInitialize.call(this,t);game.camera=new ex.BaseCamera(t);var e=game.sceneHash.level0,r=e.stats,o=r.numBoatsDestroyed,s=r.damageTaken,h=r.healthGained,i=window.ga;i&&(i("send","event","Gameover","level0","Death",{nonInteraction:1}),i("send","event","DeathStats","level0","Boats Destroyed",{eventValue:o,nonInteraction:1}),i("send","event","DeathStats","level0","Damage Taken",{eventValue:s,nonInteraction:1}),i("send","event","DeathStats","level0","Health Gained",{eventValue:h,nonInteraction:1}));Resources.SoundDeath.play();u=new ex.Actor(0,0,t.canvas.width,t.canvas.height);u.addDrawing("bg",new ex.Sprite(Resources.DeathTexture,0,0,t.canvas.width,t.canvas.height));f=new ex.Timer(function(){window.location.reload()},Config.deathTimer,!1);game.addChild(u);game.addTimer(f)},t}(ex.Scene),Fx,Resources,Palette,KrakenMode,Kraken,game,loader,resource,beginGame;(function(n){var t=function(){function n(n){this.color=n}return n.prototype.updatePixel=function(n,t,i){var r=(n+t*i.width)*4,u=i.data;u[r+3]!==0&&(u[r+0]=this.color.r*u[r+0]/255,u[r+1]=this.color.g*u[r+1]/255,u[r+2]=this.color.b*u[r+2]/255)},n}();n.Multiply=t})(Fx||(Fx={}));var BaseLevel=function(n){function t(t){var i=this;n.call(this);this.jsonPath=t;this.enemies=[];this.paths={};this.onprogress=function(){};this.oncomplete=function(){};this.onerror=function(){};this._objectFactories={PlayerSpawn:function(n){ex.Logger.getInstance().info("Released the Kraken!",n.x,n.y);i.kraken=new Kraken(n.x,n.y);i.addChild(i.kraken);game.camera.setActorToFollow(i.kraken)},EnemySpawn:function(n){var t=new Enemy(n.name,n.x,n.y);i.enemies.push(t);i.addChild(t);i.stats.numBoats++},Path:function(n){n.polyline&&n.name&&(n.polyline.forEach(function(t){t.x=n.x+t.x;t.y=n.y+t.y}),i.paths[n.name]=n.polyline.map(function(n){return new ex.Point(n.x,n.y)}))}}}return __extends(t,n),t.prototype.onInitialize=function(){var f=this,u,n,i,t,r;for(Resources.SoundWaves.setVolume(.1),Resources.SoundWaves.setLoop(!0),Resources.SoundWaves.play(),this.stats=new Stats,this.map=new ex.TileMap(0,0,this.data.tilewidth,this.data.tileheight,this.data.height,this.data.width),this.heartSprite=new ex.Sprite(Resources.Heart,0,0,20,20),this.data.tilesets.forEach(function(n){var i=Math.floor(n.imagewidth/n.tilewidth),r=Math.floor(n.imageheight/n.tileheight),t=new ex.SpriteSheet(n.texture,i,r,n.tilewidth,n.tileheight);t.sprites.forEach(function(n){return n.addEffect(new Fx.Multiply(Palette.ColorNightTime))});f.map.registerSpriteSheet(n.firstgid.toString(),t)}),u=0;u<this.data.layers.length;u++){if(t=this.data.layers[u],t.type==="tilelayer")for(n=0;n<t.data.length;n++)i=t.data[n],i!==0&&(r=this.getTilesetForTile(i),r&&(this.map.data[n].sprites.push(new ex.TileSprite(r.firstgid.toString(),i-r.firstgid)),this.map.data[n].solid=this.map.data[n].solid||this.isTileSolid(i,t,r)));t.type==="objectgroup"&&t.objects.forEach(function(n){n.type&&f._objectFactories[n.type]&&f._objectFactories[n.type](n)})}this.resolveEnemyPaths();this.addTileMap(this.map)},t.prototype.onDeactivate=function(){n.prototype.onDeactivate.call(this);Resources.SoundWaves.stop()},t.prototype.update=function(t,i){n.prototype.update.call(this,t,i);this.enemies=this.enemies.filter(function(n){return!n._isKilled});var r=this.data.width*this.data.tilewidth,u=this.data.height*this.data.tileheight;(this.kraken.x<0||this.kraken.x>r||this.kraken.y<0||this.kraken.y>u)&&game.goToScene("victory")},t.prototype.draw=function(t,i){var u,f,r;for(n.prototype.draw.call(this,t,i),t.restore(),u=game.currentScene.kraken.health,f=Math.floor(u/10),r=0;r<f;r++)this.heartSprite.draw(t,(this.heartSprite.width+5)*r+10,10);t.save();game.camera.update(0)},t.prototype.load=function(){var t=this,i=new ex.Promise,n=new XMLHttpRequest;return n.open("GET",this.jsonPath,!0),n.onprogress=this.onprogress,n.onerror=this.onerror,n.onload=function(){t.data=JSON.parse(n.response);var r=[];t.data.tilesets.forEach(function(n){n.texture=new ex.Texture(n.image);n.texture.oncomplete=n.texture.onerror=function(){var u=r.indexOf(n.texture);r.splice(u,1);r.length===0&&(t.oncomplete(),i.resolve(t.data))};r.push(n.texture)});r.forEach(function(n){return n.load()})},n.send(),i},t.prototype.isLoaded=function(){return this.data!==undefined},t.prototype.resolveEnemyPaths=function(){var n=this;this.enemies.forEach(function(t){t.key&&n.paths[t.key]&&t.createMovePath(n.paths[t.key])})},t.prototype.getTilesetForTile=function(n){for(var i,t=this.data.tilesets.length-1;t>=0;t--)if(i=this.data.tilesets[t],i.firstgid<=n)return i;return null},t.prototype.isTileSolid=function(n,t,i){var f,r,e,u;if(n===0)return!1;if(f=[],i.terrains)for(r=0;r<i.terrains.length;r++)(e=i.terrains[r],e.properties&&e.properties.solid==="false")||f.push(r);if(t.properties&&t.properties.solid==="true")return!0;if(i.tiles&&(u=i.tiles[(n-1).toString()],u&&u.terrain))for(r=0;r<u.terrain.length;r++)if(f.indexOf(u.terrain[r])>-1)return!0;return!1},t}(ex.Scene),Sonar=function(n){function t(t,i,r,u,f){n.call(this,t,i,r,u,f);this._isOn=!1;this.x=t-this.getWidth()/2;this.y=i-this.getHeight()/2;this.collisionType=1}return __extends(t,n),t.prototype.update=function(t,i){n.prototype.update.call(this,t,i);this.x=this.parent.getWidth()/2-this.getWidth()/2;this.y=this.parent.getHeight()/2-this.getHeight()/2},t.prototype.draw=function(n){if(this._isOn){n.strokeStyle=ex.Color.Red.toString();n.beginPath();var t=this.parent.getWidth()/2,i=this.parent.getHeight()/2;n.arc(-t+this.x+this.getWidth()/2,-i+this.y+this.getHeight()/2,this.getWidth()/2,0,2*Math.PI);n.arc(-t+this.x+this.getWidth()/2,-i+this.y+this.getHeight()/2,this.getWidth()/2,2*Math.PI,0,!0);n.closePath();n.stroke()}},t}(ex.Actor),Enemy=function(n){function t(t,i,r,u,f,e,o){n.call(this,i,r,Config.defaultEnemyWidth,Config.defaultEnemyHeight,e);this.key=t;this.health=Config.defaultEnemyHealth;this.alertStatus=0;this.rays=[];this.originalRays=[];this._rayVectors=[];this._bulletTimer=0;this.alertSprite=new ex.Sprite(Resources.AlertTexture,0,0,60,60);this.movePath=[];this.setWidth(u||Config.defaultEnemyWidth);this.setHeight(f||Config.defaultEnemyHeight);this.health=o||this.health;this._travelVector=new ex.Vector(1,0);this._originalTravelVector=new ex.Vector(1,0);this._fovLength=Config.defaultEnemyFOV;this._shipSheet=new ex.SpriteSheet(Resources.Ship1Texture,3,2,191,73);this.addDrawing("full",this._shipSheet.getSprite(0));this.addDrawing("half",this._shipSheet.getSprite(1));this.addDrawing("eighty",this._shipSheet.getSprite(2));var s=this._shipSheet.getAnimationByIndices(game,[3,4,5],200);this.addDrawing("explode",s);this.setCenterDrawing(!0);this.setDrawing("full");this.collisionType=4}return __extends(t,n),t.prototype.onInitialize=function(n){var i,t;for(this._kraken=n.currentScene.kraken,this.rotation=Math.PI/2,this._lightStartPoint=new ex.Point(this.x+this.getWidth(),this.y+this.getHeight()/2),i=[-.62,-.25,0,.25,.62],t=0;t<5;t++){var r=this._lightStartPoint,u=new ex.Vector(1,i[t]),f=new ex.Ray(r,u),e=new ex.Ray(r,u);this.rays.push(f);this.originalRays.push(e)}this.on("DistressEvent",function(){});this.on("AttackEvent",function(){})},t.prototype.update=function(t,i){var f=this,u,r;for(n.prototype.update.call(this,t,i),this._lightStartPoint=new ex.Point(this.x+this.getWidth(),this.y+this.getHeight()/2),this._lightStartPoint=this.rotatePoint(this._lightStartPoint,this.rotation,this.getCenter()),this.health<Config.defaultEnemyHealth&&this.health>=Config.defaultEnemyHealth*.8&&this.setDrawing("full"),this.health<Config.defaultEnemyHealth*.8&&this.health>=Config.defaultEnemyHealth*.5&&this.setDrawing("half"),this.health<Config.defaultEnemyHealth*.5&&this.health>=0&&this.setDrawing("eighty"),this.health<0&&!this.isDead&&(game.camera.shake(10,10,600),this.setDrawing("explode"),Resources.SinkSound.play(),this.isDead=!0,u=new ex.Timer(function(){f.kill();game.currentScene.kraken.health+=Config.krakenHealthRegen;game.currentScene.stats.healthGained+=Config.krakenHealthRegen},600,!1),game.currentScene.addTimer(u),game.currentScene.stats.numBoatsDestroyed++),r=0;r<this.rays.length;r++)this.rays[r].pos=this._lightStartPoint,this.rays[r].dir=this.rotateVector(this.originalRays[r].dir,this.rotation),this._travelVector=this.rotateVector(this._originalTravelVector,this.rotation);this.detectKraken()==1||this.detectKraken()==2&&(this.alertStatus=2,game.currentScene.stats.numBoatsAlerted=1);this.alertStatus==1?this.triggerEvent("DistressEvent",new DistressEvent(this)):this.alertStatus==2&&(this.triggerEvent("AttackEvent",new AttackEvent(this)),this.within(this._kraken,Config.defaultEnemyMaxFiringDistance)?this.attack(i):this.alertStatus=0)},t.prototype.createMovePath=function(n){var i=this,t,r,u;for(this.movePath=n,n.forEach(function(t,r){if(i.moveTo(t.x-i.getWidth()/2,t.y-i.getHeight()/2,Config.defaultEnemySpeed),n[r+1]){var u=new ex.Vector(n[r+1].x,n[r+1].y).minus(t.toVector()).normalize(),f=Math.atan2(u.y,u.x);i.rotateTo(f,Config.enemyRotationSpeed)}}),this.delay(Config.defaultEnemyWaitTime),t=n.length-1;t>=0;t--)this.moveTo(n[t].x-this.getWidth()/2,n[t].y-this.getHeight()/2,Config.defaultEnemySpeed),n[t-1]&&(r=new ex.Vector(n[t-1].x,n[t-1].y).minus(n[t].toVector()).normalize(),u=Math.atan2(r.y,r.x),this.rotateTo(u,Config.enemyRotationSpeed));this.repeatForever()},t.prototype.detectKraken=function(){for(var i,n,t=0,u=this._kraken.getLines(),r=0;r<this.rays.length;r++)for(i=0;i<u.length;i++)n=this.rays[r].intersect(u[i]),t!=2&&n>=Config.defaultMaxAttackDistance&&n<=Config.defaultMaxAlertDistance&&(t=1),n>=0&&n<=Config.defaultMaxAttackDistance&&(t=2);return t},t.prototype.canSeeKraken=function(){for(var n,r,i=this._kraken.getLines(),t=0;t<this.rays.length;t++)for(n=0;n<i.length;n++)if(r=this.rays[t].intersect(i[n]),r>=0)return!0;return!1},t.prototype.createSpotlight=function(){},t.prototype.createRadar=function(){},t.prototype.rotatePoint=function(n,t,i){var r=Math.sin(t),u=Math.cos(t),f=u*(n.x-i.x)-r*(n.y-i.y)+i.x,e=r*(n.x-i.x)+u*(n.y-i.y)+i.y;return new ex.Point(f,e)},t.prototype.rotateVector=function(n,t){var i=this.rotatePoint(n.toPoint(),t,new ex.Point(0,0));return new ex.Vector(i.x,i.y)},t.prototype.draw=function(t,i){n.prototype.draw.call(this,t,i);this.drawFOV(this._lightStartPoint,t,i);this.alertStatus===2&&this.alertSprite.draw(t,this.getCenter().x+Config.enemyAlertOffsetX-this.alertSprite.width/2,this.getCenter().y+Config.enemyAlertOffsetY-this.alertSprite.height/2)},t.prototype.attack=function(n){if(this._bulletTimer<=0){ex.Logger.getInstance().info("Shot bullet");var t=this.rotatePoint(new ex.Point(this.getCenter().x+Config.enemyGunOffset,this.getCenter().y),this.rotation,this.getCenter());game.addChild(new Bullet(t.x,t.y,this._kraken.getCenter().x,this._kraken.getCenter().y));Resources.BulletSound.play();this._bulletTimer=Config.defaultEnemyBulletWait}this._bulletTimer-=n},t.prototype.assistShip=function(n){this.clearActions();this.follow(n,50)},t.prototype.drawFOV=function(n,t){var u=new ex.Ray(n,this._travelVector),r=u.getPoint(this._fovLength),i=t.createRadialGradient(n.x,n.y,10,r.x,r.y,this._fovLength/2);this.alertStatus!==2?(i.addColorStop(0,"rgba(255, 255, 255, 0.3)"),i.addColorStop(1,"rgba(255, 255, 255, 0)")):(i.addColorStop(0,"rgba(255, 150, 150, 0.3)"),i.addColorStop(1,"rgba(255, 150, 150, 0)"));t.fillStyle=i;t.beginPath();t.arc(this.getCenter().x,this.getCenter().y,this._fovLength-200,0,Math.PI*2);t.closePath();t.fill()},t.prototype.debugDraw=function(t){var r=this,i,u;for(n.prototype.debugDraw.call(this,t),i=0;i<this.rays.length;i++)t.beginPath(),t.moveTo(this.rays[i].pos.x,this.rays[i].pos.y),u=this.rays[i].getPoint(Config.defaultMaxAlertDistance),t.lineTo(u.x,u.y),t.strokeStyle=ex.Color.Chartreuse.toString(),t.stroke(),t.closePath();this.movePath&&(t.beginPath(),this.movePath.forEach(function(n,i){t.moveTo(n.x,n.y);i<r.movePath.length-1&&t.lineTo(r.movePath[i+1].x,r.movePath[i+1].y)}),t.closePath(),t.strokeStyle=ex.Color.Violet.toString(),t.stroke())},t}(ex.Actor),AlertStatus;(function(n){n[n.Calm=0]="Calm";n[n.Warn=1]="Warn";n[n.Attack=2]="Attack"})(AlertStatus||(AlertStatus={}));Resources={SoundTrack:new ex.Sound("/sounds/KrakenMusic.mp3","/sounds/KrakenMusic.wav"),Level0:new BaseLevel("/maps/Level-0.json"),SplashTexture:new ex.Texture("/images/splash.jpg"),DeathTexture:new ex.Texture("/images/death.jpg"),VictoryTexture:new ex.Texture("/images/victory.jpg"),KrakenTexture:new ex.Texture("/images/kraken/KrakenSpriteSheet.png"),StartButtonTexture:new ex.Texture("/images/start.png"),Ship1Texture:new ex.Texture("/images/ship-1.png"),BulletTexture:new ex.Texture("/images/bullet.png"),AlertTexture:new ex.Texture("/images/alert.png"),BulletSound:new ex.Sound("/sounds/shoot.mp3","/sounds/shoot.wav"),SinkSound:new ex.Sound("/sounds/shipsink.mp3","/sounds/shipsink.wav"),TerrainTexture:new ex.Texture("/images/tilesets/terrain.png"),SoundSwim:new ex.Sound("/sounds/swim.mp3","/sounds/swim.wav"),SoundHurt:new ex.Sound("/sounds/hurt.mp3","/sounds/hurt.wav"),SoundWaves:new ex.Sound("/sounds/waves.mp3","/sounds/waves.wav"),SoundDeath:new ex.Sound("/sounds/death.mp3","/sounds/death.wav"),HitSound:new ex.Sound("/sounds/hit.mp3","/sounds/hit.wav"),Heart:new ex.Texture("/images/heart.png")};Palette={ColorNightTime:new ex.Color(51,27,96),ColorKrakenBlend:new ex.Color(80,48,140),ColorKrakenGlowStart:new ex.Color(65,102,197,.5),ColorKrakenGlowEnd:new ex.Color(14,26,55,0)},function(n){n[n.Idle=0]="Idle";n[n.Attack=1]="Attack";n[n.Swim=2]="Swim"}(KrakenMode||(KrakenMode={}));Kraken=function(n){function t(t,i,r,u){var f,e,o,s;n.call(this,t,i,Config.defaultKrakenWidth,Config.defaultKrakenHeight,r);this.health=Config.defaultKrakenHealth;this._travelVector=new ex.Vector(0,0);this._currentMode=0;this._lastAttackTime=Date.now();this._spinning=!1;this._animationTimer=0;this.health=u||this.health;f=new ex.SpriteSheet(Resources.KrakenTexture,4,3,120,60);f.sprites.forEach(function(n){return n.addEffect(new Fx.Multiply(Palette.ColorKrakenBlend))});e=f.getAnimationByIndices(game,[0,1,2,3],200);e.loop=!0;e.setScaleX(1.5);e.setScaleY(1.5);this.setCenterDrawing(!0);o=f.getAnimationByIndices(game,[4,5,6],200);o.loop=!0;o.setScaleX(1.5);o.setScaleY(1.5);this.setCenterDrawing(!0);s=f.getAnimationByIndices(game,[8,7,9,7],200);s.loop=!0;s.setScaleX(1.5);s.setScaleY(1.5);this.setCenterDrawing(!0);this.addDrawing("idle",s);this.addDrawing("attack",o);this.addDrawing("swim",e);this.setDrawing("idle")}return __extends(t,n),t.prototype.handleAttackPress=function(){var n=this.getClosestEnemy();this._canAttack&&n&&this.attack(n)},t.prototype.getClosestEnemy=function(){var t=this,i=game.currentScene.enemies,n=i.sort(function(n,i){return n.getCenter().distance(t.getCenter())-i.getCenter().distance(t.getCenter())})[0];return n&&n.getCenter().distance(this.getCenter())<=Config.krakenAttackRange?n:null},t.prototype.checkForShipProximity=function(){var n=this.getClosestEnemy();n?this._canAttack=!0:(this._canAttack=!1,this._currentMode===1&&this.returnToSwim())},t.prototype.onInitialize=function(n){var t=this,i;ex.Logger.getInstance().info("Kraken initialized");Resources.SoundSwim.setVolume(.3);i=new ex.Timer(function(){t._currentMode===2&&Resources.SoundSwim.play()},800,!0);n.currentScene.addTimer(i);n.on("mousemove",function(n){t.moveKraken(n.x,n.y)});n.on("keyup",function(n){n.key===32&&t.handleAttackPress()});this.on("collision",function(i){i.other||(t.dx=0,t.dy=0);i.other instanceof Bullet&&!i.other._isKilled&&(ex.Logger.getInstance().info("Kraken got shot, yo!"),t.health-=Config.enemyDps,n.currentScene.stats.damageTaken+=Config.enemyDps,Resources.SoundHurt.play(),i.other.kill())})},t.prototype.update=function(t,i){if(n.prototype.update.call(this,t,i),this.health<=0){game.goToScene("death");return}this.checkForShipProximity();var r=this._travelVector.normalize().scale(Config.krakenInertiaDampen).scale(-1);Math.abs(this.dx)<Config.defaultKrakenIdleThreshold&&(this.dx=0);Math.abs(this.dy)<Config.defaultKrakenIdleThreshold&&(this.dy=0);this.setAnimationState(i);this.dx>r.x&&this.dx!==0&&(this.dx+=r.x);this.dx<r.x&&this.dx!==0&&(this.dx+=r.x);this.dy>r.y&&this.dy!==0&&(this.dy+=r.y);this.dy<r.y&&this.dy!==0&&(this.dy+=r.y)},t.prototype.moveKraken=function(n,t){var r=new ex.Vector(n,t),u,i,f;r.minus(this.getCenter()).distance()>Config.defaultKrakenMoveRadius&&(u=new ex.Ray(this.getCenter(),r.minus(this.getCenter())),r=u.getPoint(Config.defaultKrakenMoveRadius).toVector());i=r.minus(this.getCenter());i.normalize().scale(Config.defaultKrakenSpeedScale);this._travelVector=i;this.move(i.x,i.y);i.normalize();f=Math.atan2(i.y,i.x);this._spinning||(this.rotation=f)},t.prototype.move=function(n,t){this.dx=n;this.dy=t},t.prototype.setAnimationState=function(n){if(this.dx===0&&this.dy===0&&this._animationTimer<=0&&this._currentMode!==1&&this._currentMode!==0){ex.Logger.getInstance().info("Setting animation state to Idle",this.dx,this.dy);this.setDrawing("idle");this._currentMode=0;this._animationTimer=Config.defaultKrakenAnimationChangeThreshold;return}if(this.dx!==0&&this.dy!==0&&this._animationTimer<=0&&this._currentMode!==1&&this._currentMode!==2){ex.Logger.getInstance().info("Setting animation state to Swim",this.dx,this.dy);this.setDrawing("swim");this._currentMode=2;this._animationTimer=Config.defaultKrakenAnimationChangeThreshold;return}this._animationTimer-=n},t.prototype.returnToSwim=function(){var n=this,t;this._currentMode===1?this.actionQueue.hasNext()||(ex.Logger.getInstance().info("Kraken.returnToSwim: Returning to swim"),t=this.rotation,this.clearActions(),this._spinning=!0,this.rotateBy(this.rotation+Math.PI,200).callMethod(function(){n.setDrawing("swim");n.rotation=t;n._currentMode=2;ex.Logger.getInstance().info("Kraken.returnToSwim: Setting mode to Swim after rotate");n._spinning=!1})):(this.setDrawing("swim"),this._currentMode=2,ex.Logger.getInstance().info("Kraken.returnToSwim: Setting mode to Swim"))},t.prototype.attack=function(n){var t=this,i;Date.now()-this._lastAttackTime>Config.krakenAttackTime&&(this._currentMode!==1&&(this._currentMode=1,ex.Logger.getInstance().info("Kraken.attack: Setting mode to Attack"),i=this.rotation,this.clearActions(),this._spinning=!0,this.rotateBy(this.rotation+Math.PI,200).callMethod(function(){t.setDrawing("attack");t.rotation=i;t._spinning=!1})),n&&(Resources.HitSound.play(),game.camera.shake(10,10,200),n.health-=Config.krakenDps,n.alertStatus=2,game.currentScene.stats.damageDealt+=Config.krakenDps),this._lastAttackTime=Date.now())},t.prototype.getLines=function(){var n=[],i=new ex.Point(this.x,this.y),t=new ex.Point(this.x+this.getWidth(),this.y),f=new ex.Line(i,t),r=new ex.Point(t.x,t.y+this.getHeight()),e=new ex.Line(t,r),u=new ex.Point(this.x,this.y+this.getHeight()),o=new ex.Line(r,u),s=new ex.Line(u,i);return n.push(f),n.push(e),n.push(o),n.push(s),n},t.prototype.draw=function(t,i){this.drawGlow(t,i);n.prototype.draw.call(this,t,i)},t.prototype.drawGlow=function(n){var t=n.createRadialGradient(this.getCenter().x,this.getCenter().y,10,this.getCenter().x,this.getCenter().y,150);t.addColorStop(0,Palette.ColorKrakenGlowStart.toString());t.addColorStop(1,Palette.ColorKrakenGlowEnd.toString());n.fillStyle=t;n.beginPath();n.arc(this.getCenter().x,this.getCenter().y,150,0,Math.PI*2);n.closePath();n.fill()},t}(ex.Actor);document.getElementById("sound").addEventListener("click",function(){hasClass(this,"fa-volume-up")?(replaceClass(this,"fa-volume-up","fa-volume-off"),setVolume(0)):(replaceClass(this,"fa-volume-off","fa-volume-up"),setVolume(.5))});game=new ex.Engine(920,580,"game");ex.Logger.getInstance().defaultLevel=3;game.backgroundColor=ex.Color.fromHex("#030d18");game.setAntialiasing(!1);game.camera=new ex.TopCamera(game);loader=new ex.Loader;for(resource in Resources)Resources.hasOwnProperty(resource)&&loader.addResource(Resources[resource]);beginGame=function(){game.currentScene!==Resources.Level0&&(game.off("keyup",beginGame),game.off("mouseup",beginGame),game.addScene("level0",Resources.Level0),game.addScene("death",new DeathScene),game.addScene("victory",new VictoryScene),game.goToScene("level0"))};game.start(loader).then(function(){var t=new ex.Actor(0,0,game.width,game.height),n;t.addDrawing("bg",new ex.Sprite(Resources.SplashTexture,0,0,game.width,game.height));Resources.SoundTrack.setVolume(.2);Resources.SoundTrack.setLoop(!0);Resources.SoundTrack.play();game.addChild(t);n=new ex.Actor(game.width/2-329/2,game.height-120,329,76);n.collisionType=0;n.addDrawing("bg",new ex.Sprite(Resources.StartButtonTexture,0,0,329,76));n.blink(.5,6e3,500).repeatForever();game.addChild(n);game.on("keyup",beginGame);game.on("mouseup",beginGame)});var DistressEvent=function(n){function t(t){n.call(this);this.enemy=t}return __extends(t,n),t}(ex.GameEvent),AttackEvent=function(n){function t(t){n.call(this);this.enemy=t}return __extends(t,n),t}(ex.GameEvent),Stats=function(){function n(){this.numBoatsDestroyed=0;this.numBoatsAlerted=0;this.damageTaken=0;this.damageDealt=0;this.healthGained=0;this.timeToFinishLevel=0;this.numBoats=0;this.krakenHealth=Config.defaultKrakenHealth}return n}(),VictoryScene=function(n){function t(){n.call(this)}return __extends(t,n),t.prototype.onInitialize=function(t){var i,y,o,s,h,c;n.prototype.onInitialize.call(this,t);game.camera=new ex.BaseCamera(t);var e=game.getWidth(),g=game.getHeight(),w=game.sceneHash.level0,r=w.stats,l=r.numBoatsDestroyed,a=r.damageTaken,v=r.healthGained,u="C",b=1-(r.numBoats-l)/r.numBoats,p=Config.defaultKrakenHealth,k=Config.defaultKrakenHealth+v-a,d=1-(p-k)/p,f=(b+d)/2;f>.5&&(u="B");f>.8&&(u="A");f>1&&(u="S");f>1.5&&(u="S+");i=window.ga;i&&(i("send","event","Gameover","level0","Win",{nonInteraction:1}),i("send","event","WinStats","level0","Aggregate Score",{eventValue:Math.round(f*100),nonInteraction:1}),i("send","event","WinStats","level0","Boats Destroyed",{eventValue:l,nonInteraction:1}),i("send","event","WinStats","level0","Damage Taken",{eventValue:a,nonInteraction:1}),i("send","event","WinStats","level0","Health Gained",{eventValue:v,nonInteraction:1}));y=new ex.Actor(0,0,game.width,game.height);y.addDrawing("bg",new ex.Sprite(Resources.VictoryTexture,0,0,game.width,game.height));this.addChild(y);o=new ex.Label("boats destroyed     "+l,e/2,350,"50px Iceland");o.color=ex.Color.White;o.textAlign=2;this.addChild(o);s=new ex.Label("damage taken     "+a,e/2,400,"50px Iceland");s.color=ex.Color.White;s.textAlign=2;this.addChild(s);h=new ex.Label("health gained     "+v,e/2,450,"50px Iceland");h.color=ex.Color.White;h.textAlign=2;this.addChild(h);c=new ex.Label("grade     "+u,e/2,550,"75px Iceland");c.color=ex.Color.White;c.textAlign=2;this.addChild(c)},t}(ex.Scene);
/*
//# sourceMappingURL=original.min.js.map
*/